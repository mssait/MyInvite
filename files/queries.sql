CREATE TABLE IF NOT EXISTS ROLES (
    ID SERIAL PRIMARY KEY,
    ROLE VARCHAR(100) UNIQUE NOT NULL
);

INSERT INTO ROLES (ROLE)
VALUES
    ('USER_ADMIN'),
    ('USER');

CREATE TABLE IF NOT EXISTS USER_TYPES (
    ID SERIAL PRIMARY KEY,
    TYPE VARCHAR(100) UNIQUE NOT NULL
);

INSERT INTO USER_TYPES (TYPE)
VALUES
    ('User_admin'),
    ('User');

CREATE TABLE USERS (
    ID BIGSERIAL PRIMARY KEY,
    TYPE_ID INT REFERENCES USER_TYPES(ID),
    NAME VARCHAR(100),
    EMAIL VARCHAR(100) UNIQUE,
    PHONE_NUMBER VARCHAR(15) UNIQUE,
    PROFILE_PIC VARCHAR(250),
    PASSWORD VARCHAR(250),
    IS_ACTIVE BOOLEAN DEFAULT TRUE,
    CREATED_TIME BIGINT DEFAULT EXTRACT(EPOCH FROM NOW())*1000,
    PASSWORD_RESET_TOKEN VARCHAR(250),
    PASSWORD_RESET_TOKEN_EXPIRY BIGINT
);

INSERT INTO USERS (TYPE_ID, NAME, EMAIL, PHONE_NUMBER, PASSWORD, PROFILE_PIC)
VALUES ( 
     1,
    'Sanjay',
    'sanjay@hionstudios.com', 
    '7397541499',
    'password',
    'fgh5a5a9fdd661b51450faab7bc3e4056d8cd'
),
( 
     2,
    'Eanok',
    'eanok@hionstudios.com', 
    '7397541498',
    'password',
    'fgh5a35b55322c6af4c298eda5d437deb5507'
),
( 
     2,
    'Ajay',
    'ajay@hionstudios.com', 
    '7397541497',
    'password',
    'fgh5a6bf50ddbc2044702a2a63828df227a6f'
)
;

CREATE TABLE USER_ROLES (
    USER_ID BIGINT REFERENCES USERS(ID),
    ROLE_ID INT REFERENCES ROLES(ID),
    PRIMARY KEY(USER_ID, ROLE_ID)
);

INSERT INTO USER_ROLES (USER_ID, ROLE_ID)
VALUES (
         1,
         1
       ),
       (
         2,
         2
       ),
       (
        3,
        2
       );

CREATE TABLE IF NOT EXISTS OAUTHS (
    ID BIGSERIAL PRIMARY KEY,
    PROVIDER VARCHAR(25),
    ACCESS_TOKEN VARCHAR(100),
    REFRESH_TOKEN VARCHAR(100),
    EXPIRY BIGINT
);

INSERT INTO
    OAUTHS (PROVIDER, ACCESS_TOKEN, REFRESH_TOKEN, EXPIRY)
VALUES
    ('zoho', '', '', 0),
    ('google', '', '', 0),
    ('facebook', '', '', 0);

CREATE TABLE IF NOT EXISTS EVENT_TYPES (
    ID BIGSERIAL PRIMARY KEY,
    TYPE VARCHAR(100) UNIQUE,
    IMAGE VARCHAR(250)
);

INSERT INTO EVENT_TYPES (TYPE, IMAGE)
VALUES
	('Weddings & Engagements', 'fgh5a4ec15fbfae9c4ce2bed9d949f95f8eae'),
    ('Birthday Parties', 'fgh5a52cd367202e645aa9cbf7c9982ba2b6f'),
    ('Festivals & Cultural Events', 'fgh5a63d2b29747454f95987518bffab1827c'),
    ('Corporate Events', 'fgh5a5833b695c7794554af1477002eb94804'),
    ('Family Gatherings', 'fgh5a0e0787c36b374f7d85c35b2d92d3e360'),
    ('Concerts & Entertainment', 'fgh5a8c18b01ad49141f9ab2a63b234557397'),
    ('Community & Networking Events', 'fgh5a790bb15c590d45648121b804cbdaaec8'),
    ('Workshops & Training', 'fgh5ae1b9443e731047da8020d5fbb170094a'),
    ('Pre/Post Wedding Events', 'fgh5ab4a47be1cb7f4a929b5ee6c494d04b47'),
    ('Others', 'fgh5a17e3336827f943f3926e84acc2169e08');

CREATE TABLE IF NOT EXISTS BUDGET_TYPES (
    ID BIGSERIAL PRIMARY KEY,
    TYPE VARCHAR(100) UNIQUE
);

INSERT INTO BUDGET_TYPES (TYPE)
VALUES
	('Venue & Decoration'),
    ('Catering & Food'),
    ('Photography & Videography'),
    ('Makeup & Styling'),
    ('Invitation & Stationery'),
    ('Entertainment & Music'),
    ('Outfits & Accessories'),
    ('Transportation & Logistics'),
    ('Lighting & Stage Setup'),
    ('Accommodation & Hospitality'),
    ('Event Planning & Coordination'),
    ('Gifts & Return Gifts'),
    ('Ceremony Rituals & Pooja Items'),
    ('Cake & Desserts'),
    ('Others');

CREATE TABLE IF NOT EXISTS CARPOOL_GUEST_STATUSES (
    ID BIGSERIAL PRIMARY KEY,
    STATUS VARCHAR(100) UNIQUE
);

INSERT INTO CARPOOL_GUEST_STATUSES (STATUS)
VALUES 
      ('Pending'),
      ('Accepted'),
      ('Rejected');

CREATE TABLE IF NOT EXISTS RSVP_STATUSES (
    ID BIGSERIAL PRIMARY KEY,
    STATUS VARCHAR(100) UNIQUE
);   

INSERT INTO RSVP_STATUSES (STATUS)
VALUES
      ('ATTENDING'),
      ('MAY BE'),
      ('NO');


CREATE TABLE IF NOT EXISTS EVENTS (
    ID BIGSERIAL PRIMARY KEY,
    OWNER_ID BIGINT REFERENCES USERS(ID),
    EVENT_TYPE_ID BIGINT REFERENCES EVENT_TYPES(ID),
    TITLE VARCHAR(250),
    DESCRIPTION TEXT,
    NO_OF_GUEST INT DEFAULT 0,
    DATE BIGINT,
    START_TIME BIGINT,
    END_TIME BIGINT,
    ADDRESS VARCHAR(300),
    GIFT_SUGGESTION TEXT,
    LOCATION_LATITUDE NUMERIC(10, 7),
    LOCATION_LONGITUDE NUMERIC(10, 7),
    COMPLETED BOOLEAN DEFAULT FALSE,
    CREATED_TIME BIGINT DEFAULT EXTRACT(EPOCH FROM NOW())*1000
);

CREATE TABLE IF NOT EXISTS EVENT_THUMBNAILS (
    ID BIGSERIAL PRIMARY KEY,
    EVENT_ID BIGINT REFERENCES EVENTS(ID),
    IMAGE VARCHAR(250),
    CREATED_TIME BIGINT DEFAULT EXTRACT(EPOCH FROM NOW())*1000
);

CREATE TABLE IF NOT EXISTS EVENT_BUDGETS (
    ID BIGSERIAL PRIMARY KEY,
    EVENT_ID BIGINT REFERENCES EVENTS(ID),
    BUDGET_TYPE_ID BIGINT REFERENCES BUDGET_TYPES(ID),
	PLANNED_AMOUNT BIGINT,
    ACTUAL_AMOUNT BIGINT,
    CREATED_TIME BIGINT DEFAULT EXTRACT(EPOCH FROM NOW())*1000
);

CREATE TABLE IF NOT EXISTS EVENT_INVITES (
    ID BIGSERIAL PRIMARY KEY,
    EVENT_ID BIGINT REFERENCES EVENTS(ID) ON DELETE CASCADE,
    GUEST_ID BIGINT REFERENCES USERS(ID) ON DELETE CASCADE,
    NAME VARCHAR(100),
    PHONE_NUMBER VARCHAR(15),
    EMAIL VARCHAR(100),
    RSVP_STATUS_ID BIGINT REFERENCES RSVP_STATUSES(ID),
    CREATED_TIME BIGINT DEFAULT EXTRACT(EPOCH FROM NOW())*1000,
    UNIQUE(EVENT_ID, PHONE_NUMBER),
    UNIQUE(EVENT_ID, EMAIL)
);

CREATE TABLE IF NOT EXISTS GUEST_RSVPS (
    ID BIGSERIAL PRIMARY KEY,
    EVENT_INVITE_ID BIGINT REFERENCES EVENT_INVITES(ID) ON DELETE CASCADE,
    RSVP VARCHAR(20) REFERENCES RSVP_STATUSES(STATUS),
    COMMENT TEXT,
    NO_OF_ATTENDEES INT DEFAULT 1,
    CARPOOL_EXPECTING BOOLEAN DEFAULT FALSE,
    CARPOOL_GUEST_STATUS_ID BIGINT REFERENCES CARPOOL_GUEST_STATUSES(ID),
    CREATED_TIME BIGINT DEFAULT EXTRACT(EPOCH FROM NOW())*1000,
    UNIQUE(EVENT_INVITE_ID)
);

CREATE TABLE IF NOT EXISTS CARPOOLS (
    ID BIGSERIAL PRIMARY KEY,
    EVENT_ID BIGINT REFERENCES EVENTS(ID),
    USER_ID BIGINT REFERENCES USERS(ID),
    CAR_NUMBER VARCHAR(20),
    CAR_MODEL VARCHAR(100),
    CAR_COLOR VARCHAR(50),
    AVAILABLE_SEAT INT DEFAULT 0,
    FILLED_SEATS INT DEFAULT 0,
    LADIES_ACCOMPANIED BOOLEAN DEFAULT FALSE,
    START_LOCATION_LATITUDE NUMERIC(10, 7),
    START_LOCATION_LONGITUDE NUMERIC(10, 7),
    ADDRESS VARCHAR(300),
    START_DATE_TIME BIGINT,
    END_DATE_TIME BIGINT,
    NOTES TEXT,
    CREATED_TIME BIGINT DEFAULT EXTRACT(EPOCH FROM NOW())*1000
);

CREATE TABLE IF NOT EXISTS CARPOOL_REQUESTS (
    ID BIGSERIAL PRIMARY KEY,
    CARPOOL_ID BIGINT REFERENCES CARPOOLS(ID),
    GUEST_ID BIGINT REFERENCES USERS(ID),
    NO_OF_PEOPLE INT,
    LADIES_ACCOMPANIED BOOLEAN DEFAULT FALSE,
    NOTES TEXT,
    CREATED_TIME BIGINT DEFAULT EXTRACT(EPOCH FROM NOW())*1000,
    CARPOOL_GUEST_STATUS_ID BIGINT REFERENCES CARPOOL_GUEST_STATUSES(ID),
    UNIQUE(CARPOOL_ID, GUEST_ID)
);

CREATE TABLE IF NOT EXISTS CARPOOL_GUESTS (
    ID BIGSERIAL PRIMARY KEY,
    CARPOOL_ID BIGINT REFERENCES CARPOOLS(ID),
    CARPOOL_REQUEST_ID BIGINT REFERENCES CARPOOL_REQUESTS(ID),
    CARPOOL_GUEST_STATUS_ID BIGINT REFERENCES CARPOOL_GUEST_STATUSES(ID)
);

CREATE TABLE IF NOT EXISTS EVENT_MESSAGES (
    ID BIGSERIAL PRIMARY KEY,
    EVENT_ID BIGINT REFERENCES EVENTS(ID),
    SENDER_ID BIGINT REFERENCES USERS(ID),
    MESSAGE TEXT,
    CREATED_TIME BIGINT DEFAULT EXTRACT(EPOCH FROM NOW())*1000
);

CREATE TABLE IF NOT EXISTS EVENT_MESSAGE_READS (
    ID BIGSERIAL PRIMARY KEY,
    MESSAGE_ID BIGINT REFERENCES EVENT_MESSAGES(ID),
    RECEIPIENT_ID BIGINT REFERENCES USERS(ID) ON DELETE CASCADE,
    READ_TIME BIGINT DEFAULT EXTRACT(EPOCH FROM NOW())*1000,
    UNIQUE(MESSAGE_ID, RECEIPIENT_ID)
);

CREATE TABLE IF NOT EXISTS NOTIFICATION_TYPES (
    ID BIGSERIAL PRIMARY KEY,
    TYPE VARCHAR(100) UNIQUE
);

INSERT INTO NOTIFICATION_TYPES (TYPE)
VALUES
    ('RsvP'),
    ('Carpool'),
    ('Event'),
    ('Admin');

CREATE TABLE IF NOT EXISTS NOTIFICATIONS (
    ID BIGSERIAL PRIMARY KEY,
    SENDER_ID BIGINT REFERENCES USERS(ID),
    RECEIVER_ID BIGINT REFERENCES USERS(ID),
    EVENT_ID BIGINT REFERENCES EVENTS(ID),
    NOTIFICATION_TYPE_ID BIGINT REFERENCES NOTIFICATION_TYPES(ID),
    CONTENT VARCHAR(100),
    IS_READ BOOLEAN DEFAULT FALSE,
    HREF VARCHAR(100),
    TIME BIGINT DEFAULT EXTRACT(EPOCH FROM NOW())*1000
);

CREATE TABLE IF NOT EXISTS EVENT_TODO_LISTS (
    ID BIGSERIAL PRIMARY KEY,
    EVENT_ID BIGINT REFERENCES EVENTS(ID) ON DELETE CASCADE,
    TODO TEXT NOT NULL,
    STATUS BOOLEAN DEFAULT FALSE,
    CREATED_TIME BIGINT DEFAULT EXTRACT(EPOCH FROM NOW())*1000
);

CREATE TABLE IF NOT EXISTS BACKUPS (
    ID BIGSERIAL PRIMARY KEY,
    BACKUP_FILE VARCHAR(100) UNIQUE,
    BACKUP_DATE BIGINT
);